<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AYDYN EIS</title>
    <meta name="description" content="">
    <link rel="stylesheet" href="../../assets/css/employee-main.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="../../assets/js/moment.js"></script>
    <script src="../../assets/js/bootstrap-datetimepicker.min.js"></script>
    <script src="../../assets/js/jquery.tablesorter.js"></script>
    <script src="../../assets/js/jquery-lastest.js"></script>
    <script src="../../assets/js/bootstrap/bootstrap.min.js"></script>
  </head>
  <body>
  <div id="attendance" class="container nav-attendance-3">
    <header class="header"></header>
    <div class="wrap">
      <nav class="nav"></nav>
      <div class="content">
        <div class="info">
          <div class="title">
            <ul class="aydyn-breakcrumb">
                <li><a href="overtime.html">考勤</a></li>
                <li><a href="overtime.html">補休申請記錄</a></li>
                <li>編輯</li>
            </ul>
          </div>

          <section>
            <form class="form-horizontal">
              <div class="form-group">
                <label class="col-sm-1 control-label">狀態</label>
                <div class="col-sm-2">
                  <input type="text" class="form-control failed" value="未通過" readonly>
                </div>
                <label class="col-sm-1 control-label">回覆內容</label>
                <div class="col-sm-5">
                  <input type="text" class="form-control failed" value="工作內容不夠詳細" readonly>
                </div>
                <label class="col-sm-1 control-label">異動時間</label>
                <div class="col-sm-2">
                  <input type="text" class="form-control failed" value="2016/10/10 19:35" readonly>
                </div>
              </div>
            </form>
          </section>

          <section>
            <table id="myTable" class="table table-striped table-hover table-sort">
              <thead>
                <tr>
                  <th class="col-sm-10">申請記錄</th>
                  <td class="col-sm-2">匯入</td>
                </tr>
              </thead>

              <tbody>
                <tr class="v1" data-toggle="modal" data-target="#importModal">
                  <td>2016/10/9 15:00</td>
                  <td><a href="#"><span class="fa fa-share"></span></a></td>
                </tr>
                <tr class="v2" data-toggle="modal" data-target="#importModal">
                  <td>2016/10/9 09:00</td>
                  <td><a href="#"><span class="fa fa-share"></span></a></td>
                </tr>             
              </tbody>
            </table>
          </section>

          <section>
            <form id="myForm" class="form-horizontal">
              <div class="form-group">
                <label class="col-sm-1 control-label required">加班區間</label>
                <div class='col-md-3'>
                  <div class='input-group date' id='startDate'>
                      <input type='text' name="startDate" class="form-control" placeholder="Start Date" required>
                      <span class="input-group-addon">
                          <span class="fa fa-calendar"></span>
                      </span>
                  </div>
                </div>
                <div class='col-md-3'>
                  <div class='input-group date' id='endDate'>
                      <input type='text' name="endDate" class="form-control" placeholder="End Date" required>
                      <span class="input-group-addon">
                          <span class="fa fa-calendar"></span>
                      </span>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-1 control-label required">工作內容</label>
                <div class="col-sm-11">
                  <input type="text" name="reason" class="form-control" placeholder="請填寫工作內容" required>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-1 control-label">加班時數</label>
                <div class="col-sm-1">
                  <input type="number" class="form-control" name="field_overtime" readonly required>
                </div>
                <label class="col-sm-0 control-label">HR</label>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <label class="control-label note">*系統自動帶入</label>
              </div>

              <div class="form-group">
                <label class="col-sm-1 control-label">補休時數</label>
                <div class="col-sm-1">
                  <input type="number" class="form-control" name="field_credit" readonly>
                </div>
                <label class="col-sm-0 control-label">HR</label>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <label class="control-label note">*系統自動帶入</label>
              </div>

              <hr>

              <div class="form-group">
                <div class="col-sm-12 text-right">
                  <button type="reset" class="btn btn-default">Clear</button>
                  <button type="submit" class="btn btn-submit">Submit</button>
                </div>
              </div>
            </form>
          </section>
          <button type="button" id="back" class="btn btn-default" data-href="overtime.html"><span class="fa fa-reply"></span>Back</button>
        </div>
        <footer></footer>
        <!-- Modal -->
        <div class="modal fade" id="modalDelete" role="dialog">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span class="fa fa-window-close"></span></button>
              <div class="modal-title">
                <h2>確定離開當前頁面？</h2>
                <p>您尚未將編輯過的表單送出，資料將會流失</p>
              </div>
              <div class="form-group">
                <div class="col-sm-12 text-center">
                  <button type="button" class="btn btn-default " data-dismiss="modal" aria-label="Close">Cancel</button>
                  <a href="overtime.html" type="submit" class="btn btn-submit" aria-label="Close">Leave</a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Modal -->
      </div>
    </div>
  </div>
    

    
  </body>
  <script src="../../assets/js/function.js"></script>
  <script>
    var data = [{
      'startDate':'2016/10/10 10:00',
      'endDate':'2016/10/10 11:00',
      'reason':'XXXXXXXXXXXXXXXXXX',
      'hr':'4',
      'sum':'6',
    },
    {
      'startDate':'2016/12/30 10:00',
      'endDate':'2016/12/31 11:00',
      'reason':'vvvvvvvvvvvvvvvvv',
      'hr':'8',
      'sum':'8',
    }
    ];

    $('tr[class="v1"]').click(function(){
       var select_data = data[0];
       $('input[name="startDate"]').val(select_data.startDate);
       $('input[name="endDate"]').val(select_data.endDate);
       $('input[name="reason"]').val(select_data.reason);
       $('input[name="hr"]').val(select_data.hr);
       $('input[name="sum"]').val(select_data.sum);
     });

    $('tr[class="v2"]').click(function(){
       var select_data = data[1];
       $('input[name="startDate"]').val(select_data.startDate);
       $('input[name="endDate"]').val(select_data.endDate);
       $('input[name="reason"]').val(select_data.reason);
       $('input[name="hr"]').val(select_data.hr);
       $('input[name="sum"]').val(select_data.sum);
     });

    $('#back').click(function(){
      var check = 0;
      $('#myForm input[type!="checkbox"]').each(function(index, item){
        if(item.value != '')check++;
      });
      if(check > 0){
        $('#modalDelete').modal('show');
      }else{
        $href = $(this).data('href');
        window.location.href = $href;
      }
    });

    $('#startDate').on('dp.change', function (e) {
      console.log('here');
      caculate();
    });
    $('#endDate').on('dp.change', function (e) {
      caculate();
    });

    function caculate(){
      if($('#startDate input').val()!='' && $('#endDate input').val()!= ''){

        var sd = new Date($('#startDate input').val());
        var ed = new Date($('#endDate input').val());
        var overtime = parseInt(ed.getHours()) - parseInt(sd.getHours());
        if(parseInt(ed.getMinutes()) - parseInt(sd.getMinutes()) >30 ) overtime+=.5;
        $('input[name="field_overtime"]').val(overtime);
        $('input[name="field_credit"]').val(overtime * getCreadit(sd.getDay()));
      }
    }

    function getCreadit(weekdays){
      switch (weekdays) {
        case 0:
        case 6:
          return 1;
        default:
          return 1.5;
      }
    }
  </script>
</html>